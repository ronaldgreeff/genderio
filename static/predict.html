<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/cropper.min.css" />
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/popper-1.14.7.min.js"></script>
    <script src="js/cropper.min.js"></script>
    <meta charset="utf-8">
    <title>GenAI</title>
  </head>

  <body>
    <!-- <input type="text" name="" value="" id="name-input">
    <button type="button" name="button" id="name-button">Submit</button>
    <p id="greeting"></p> -->
    <div class="container">
      <input type="file" name="file" id="image-selector" />
    </div>

    <!-- <p>Predictions</p>
    <p>Boy: <span id="boy-prediction"></span> </p>
    <p>Girl: <span id="girl-prediction"></span> </p> -->

    <div class="container">
      <div class="row">
        <div class="col col-3">
          <div class="image-container">
            <img class="" src="" alt="" id="image" />
          </div>
        </div>
        <div class="col col-3">

        </div>
      </div>
    </div>


    <div class="container">
      <form method="post" action="" enctype="multipart/form-data" id="myform">
        <div class="preview" id="file">
        </div>
          <span><input type="text" name="weeks" value="0"><input type="text" name="days" value="0"></span>
        <div>
          <input type="button" class="button" value="Predict" id="but_upload">
          <!-- <button type="button" class="button" name="button" id="predict-button">Predict</button> -->
        </div>
      </form>
    </div>



    <!-- TODO: Add dropping tool with preset dimensions: https://foliotek.github.io/Croppie/ -->

  </body>

  <script type="text/javascript">

    // DETAILS INPUT
    // $("#name-button").click(function(event){
    //   let message = {
    //     name: $("#name-input").val()
    //   }
    //   $.post("/hello", JSON.stringify(message), function(response){
    //     $("#greeting").text(response.greeting);
    //     console.log(response);
    //   })
    // })

    // IMAGE CROP
    function crop_image(){
      const image = document.getElementById("image");
      var height = image.height() + 4;


      const cropper = new Cropper(image, {
        viewMode: 2,
        dragMode: 'move',
        initialAspectRatio: 16 / 9,
        preview: '.preview', //document.getElementById("image-preview"),
        scalable: false,
        zoomable: false,
        zoomOnTouch: false,
        crop(event) {
          // console.log(event.detail.x);
          // console.log(event.detail.y);
        },
      });
    }

    // IMAGE SELECTION
    let base64Image;
    $("#image-selector").change(function(){
      let reader = new FileReader();
      reader.onload = function(e) {
        let dataURL = reader.result;
        $("#image").attr("src", dataURL);
        base64Image = dataURL.replace("data:image/jpeg;base64,", ""); // strip out meta data
        crop_image()
      }

      reader.readAsDataURL($("#image-selector")[0].files[0]);
      $("boy-prediction").text("");
      $("girl-prediction").text("");
    });

    // IMAGE CROP

    // FORM SUBMIT
    $("#predict-button").click(function(event){
      let message = {
        image: base64Image
      }
      console.log(message);
      $.post("/predict", JSON.stringify(message), function(response){
        $("#boy-prediction").text(response.prediction.boy.toFixed(6));
        $("#girl-prediction").text(response.prediction.girl.toFixed(6));
        console.log(response);
      })
    })
  </script>

</html>

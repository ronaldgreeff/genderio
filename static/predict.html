<!DOCTYPE html>
<html lang="en" dir="ltr">

  <head>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/croppie.css" />
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/popper-1.14.7.min.js"></script>
    <script src="js/croppie.js"></script>
    <meta charset="utf-8">
    <title>GenAI</title>
  </head>

  <body>
    <!-- <input type="text" name="" value="" id="name-input">
    <button type="button" name="button" id="name-button">Submit</button>
    <p id="greeting"></p> -->
    <input type="file" name="" value="" id="image-selector">
    <button type="button" name="button" id="predict-button">Predict</button>

    <p>Predictions</p>
    <p>Boy: <span id="boy-prediction"></span> </p>
    <p>Girl: <span id="girl-prediction"></span> </p>

    <img class="my-img" src="" alt="" id="selected-image" />

    <!-- TODO: Add dropping tool with preset dimensions: https://foliotek.github.io/Croppie/ -->

  </body>

  <script type="text/javascript">

    // DETAILS INPUT
    // $("#name-button").click(function(event){
    //   let message = {
    //     name: $("#name-input").val()
    //   }
    //   $.post("/hello", JSON.stringify(message), function(response){
    //     $("#greeting").text(response.greeting);
    //     console.log(response);
    //   })
    // })

    // IMAGE SELECTION
    let base64Image;
    $("#image-selector").change(function(){
      let reader = new FileReader();
      reader.onload = function(e) {
        let dataURL = reader.result;
        $("#selected-image").attr("src", dataURL);
        base64Image = dataURL.replace("data:image/jpeg;base64,", ""); // strip out meta data
        console.log(base64Image);
      }
      reader.readAsDataURL($("#image-selector")[0].files[0]);
      $("boy-prediction").text("");
      $("girl-prediction").text("");
    });

    // IMAGE CROP

    // FORM SUBMIT
    $("#predict-button").click(function(event){
      let message = {
        image: base64Image
      }
      console.log(message);
      $.post("/predict", JSON.stringify(message), function(response){
        $("#boy-prediction").text(response.prediction.boy.toFixed(6));
        $("#girl-prediction").text(response.prediction.girl.toFixed(6));
        console.log(response);
      })
    })
  </script>

</html>
